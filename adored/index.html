<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Readable Text Over Photo or Video</title>
  <style>
    :root{
      /* Tweakables (JS auto-adjusts these) */
      --overlay: .48;                 /* darkness of scrim (0–1) */
      --blur: 0px;                    /* background blur for busy visuals */
      --saturate: 1;                  /* 0.8–1.2 usually fine */
      --grayscale: 0;                 /* 0–1; nudge toward 0.15 if colors clash */
      --bg-position: center center;   /* fallback if data-position missing */
      --text-max: 72ch;               /* max text width */
    }

    *{ box-sizing: border-box; }
    html, body{ height:100%; margin:0; }
    body{
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial, sans-serif;
      color:#fff; background:#111;
    }

    .hero{
      position: relative;
      min-height: 100dvh;
      display: grid;
      place-items: center;
      padding: clamp(1.5rem, 4vw, 6rem);
      text-align: center;
      isolation: isolate; /* creates a new stacking context */
      overflow: hidden;
    }

    /* When using an IMAGE, we paint it via a pseudo-layer */
    .hero::before{
      content:"";
      position:absolute; inset:0;
      background-image: var(--bg-image, none);
      background-size: cover;
      background-position: var(--bg-position);
      background-repeat: no-repeat;
      filter: blur(var(--blur)) saturate(var(--saturate)) grayscale(var(--grayscale));
      transform: scale(1.03);
      z-index:-2;
    }

    /* Shared scrim for contrast (applies to both image and video) */
    .hero::after{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(180deg,
          rgba(0,0,0, calc(var(--overlay) + 0.20)) 0%,
          rgba(0,0,0, var(--overlay)) 55%,
          rgba(0,0,0, calc(var(--overlay) + 0.25)) 100%);
      z-index:-1;
    }

    /* When using a VIDEO, we physically place it as a layer */
    .bg-video{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit: cover;
      object-position: var(--bg-position);
      filter: blur(var(--blur)) saturate(var(--saturate)) grayscale(var(--grayscale));
      transform: scale(1.03);
      z-index:-2;
      /* Prevent accidental selection/interaction */
      pointer-events:none;
    }

    main{ max-width: var(--text-max); margin-inline:auto; }
    h1{ font-size: clamp(2rem, 6vw, 4rem); line-height:1.1; margin:0 0 .75rem; }
    p { font-size: clamp(1rem, 2.4vw, 1.25rem); margin: 0 auto 1rem; opacity:.95; }
    .shadowy{ text-shadow: 0 2px 8px rgba(0,0,0,.65); }

    .cta{
      display:inline-block; margin-top:1.25rem; padding:.8rem 1.1rem;
      border-radius:.9rem; border:1px solid rgba(255,255,255,.35);
      background: rgba(255,255,255,.08); color:#fff; text-decoration:none; font-weight:600;
      backdrop-filter: blur(4px);
    }

    @media (prefers-reduced-motion: no-preference){
      .hero{ animation: subtle-zoom 22s ease-in-out infinite alternate; }
      @keyframes subtle-zoom{ from{ transform:scale(1) } to{ transform:scale(1.015) } }
    }
  </style>
</head>
<body>

  <!-- USAGE --------------------------------------------------------------
       • Image background:
         <section class="hero shadowy" data-bg="your-image.jpg" data-position="center center">…</section>
       • Video background (MP4/MOV). You can list multiple, comma-separated:
         <section class="hero shadowy" data-video="bg.mp4, bg.mov" data-poster="poster.jpg" data-position="center center">…</section>

       Notes:
       - Keep media on the same origin/folder as this HTML to avoid CORS blocking the
         adaptive sampler. If remote, enable CORS (Access-Control-Allow-Origin).
       - We set autoplay+muted+playsinline+loop for seamless looping backgrounds.
  ----------------------------------------------------------------------->
  <section class="hero shadowy"
           data-video="https://video.thecorruptive.com/3557AB72-AD2A-4887-8C0F-572F8A8620CC.mp4"
           data-poster="poster.jpg"
           data-position="center center">
    <main>
    </main>
  </section>

  <script>
  (function(){
    const hero = document.querySelector('.hero');
    if(!hero){ return; }

    const imgSrc   = (hero.dataset.bg || "").trim();
    const videoRaw = (hero.dataset.video || "").trim();
    const poster   = (hero.dataset.poster || "").trim();
    const pos      = (hero.dataset.position || 'center center').trim();

    document.documentElement.style.setProperty('--bg-position', pos);

    if(videoRaw){
      // VIDEO MODE --------------------------------------------------------
      // Accept comma-separated list of sources for best-compat fallbacks.
      const sources = videoRaw.split(',').map(s => s.trim()).filter(Boolean);

      const video = document.createElement('video');
      video.className   = 'bg-video';
      video.muted       = true;          // required for autoplay
      video.autoplay    = true;
      video.playsInline = true;          // iOS inline playback
      video.loop        = true;          // requested looping
      video.preload     = 'metadata';    // stream quickly; let browser manage buffering
      if(poster) video.poster = poster;

      // If you host on a different origin AND send proper CORS headers,
      // uncomment the next line so frame sampling can work cross-origin:
      // video.crossOrigin = 'anonymous';

      // Add <source> children so the browser can pick what it supports.
      for(const src of sources){
        const type = guessType(src); // e.g., 'video/mp4' or 'video/quicktime'
        const el = document.createElement('source');
        el.src = src; if(type) el.type = type;
        video.appendChild(el);
      }

      hero.prepend(video);

      // Adaptive tuning: sample frames periodically to keep text readable.
      const w = 64, h = 64;
      const canvas = document.createElement('canvas');
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');

      let stopped = false;
      let lastSample = 0;

      function onFrame(){
        if(stopped) return;
        const now = performance.now();

        // Throttle to ~2 samples/second for perf
        if(now - lastSample < 500) { requestAnimationFrame(onFrame); return; }
        lastSample = now;

        try{
          // Only sample when we have current data
          if(video.readyState >= 2 && video.videoWidth && video.videoHeight){
            const ratio = Math.max(w / video.videoWidth, h / video.videoHeight);
            const dw = video.videoWidth * ratio;
            const dh = video.videoHeight * ratio;
            const dx = (w - dw) / 2;
            const dy = (h - dh) / 2;
            ctx.drawImage(video, dx, dy, dw, dh);
            const { data } = ctx.getImageData(0, 0, w, h);
            applyAdaptiveFromPixelData(data);
          }
        }catch(err){
          // Likely a CORS-tainted canvas. Use conservative defaults and stop sampling.
          console.warn('Video adaptive tuning skipped (likely CORS). Using safe defaults.', err);
          setConservativeDefaults();
          stopped = true;
        }
        requestAnimationFrame(onFrame);
      }

      video.addEventListener('loadeddata', () => requestAnimationFrame(onFrame));
      video.addEventListener('error', () => {
        console.error('Video failed to load. Check data-video paths and file types.');
        // If video fails, but an image is present, fall back to image mode:
        if(imgSrc){ enableImageMode(imgSrc, pos); }
        else setConservativeDefaults();
      });

    }else if(imgSrc){
      // IMAGE MODE --------------------------------------------------------
      enableImageMode(imgSrc, pos);
    }else{
      console.warn('Provide either data-video (mp4/mov) or data-bg (image).');
    }

    // ---------- Helpers ----------
    function enableImageMode(src, pos){
      document.documentElement.style.setProperty('--bg-image', `url("${src}")`);
      document.documentElement.style.setProperty('--bg-position', pos);

      const img = new Image();
      // If remote with CORS headers, uncomment next line:
      // img.crossOrigin = 'anonymous';
      img.src = src;

      img.onload = function(){
        try{
          const w = 48, h = 48;
          const canvas = document.createElement('canvas');
          canvas.width = w; canvas.height = h;
          const ctx = canvas.getContext('2d');

          const ratio = Math.max(w / img.naturalWidth, h / img.naturalHeight);
          const dw = img.naturalWidth * ratio;
          const dh = img.naturalHeight * ratio;
          const dx = (w - dw) / 2;
          const dy = (h - dh) / 2;
          ctx.drawImage(img, dx, dy, dw, dh);
          const { data } = ctx.getImageData(0, 0, w, h);
          applyAdaptiveFromPixelData(data);
        }catch(err){
          console.warn('Image adaptive tuning skipped (likely CORS). Using safe defaults.', err);
          setConservativeDefaults();
        }
      };

      img.onerror = function(){
        console.error('Background image failed to load. Check data-bg path and file name.');
        setConservativeDefaults();
      };
    }

    function applyAdaptiveFromPixelData(data){
      let sum = 0, sumSq = 0, n = 0;
      for(let i = 0; i < data.length; i += 4){
        const r = data[i], g = data[i+1], b = data[i+2];
        const y = 0.2126*r + 0.7152*g + 0.0722*b; // Rec. 709 luminance (0..255)
        sum += y; sumSq += y*y; n++;
      }
      const avg = sum / n;
      const variance = Math.max(0, (sumSq / n) - (avg*avg));
      const stdev = Math.sqrt(variance);

      // Map brightness to overlay strength—brighter background => darker scrim
      const min = 0.34, max = 0.70;
      const overlay = clamp(min + (avg/255)*(max - min), min, max);

      // Busy visuals get more blur
      const blur = stdev > 60 ? map(stdev, 60, 90, 1.5, 3.0) : map(stdev, 20, 60, 0.0, 1.5);

      // Slight desaturation for neon color bombs
      const saturate = stdev > 75 ? 0.9 : 1.0;

      document.documentElement.style.setProperty('--overlay', overlay.toFixed(2));
      document.documentElement.style.setProperty('--blur', `${clamp(blur, 0, 3).toFixed(2)}px`);
      document.documentElement.style.setProperty('--saturate', saturate.toFixed(2));
    }

    function setConservativeDefaults(){
      document.documentElement.style.setProperty('--overlay', '.55');
      document.documentElement.style.setProperty('--blur', '1px');
      document.documentElement.style.setProperty('--saturate', '1');
    }

    function clamp(v, lo, hi){ return Math.min(hi, Math.max(lo, v)); }
    function map(v, inMin, inMax, outMin, outMax){
      const t = (v - inMin) / (inMax - inMin);
      return outMin + Math.min(1, Math.max(0, t)) * (outMax - outMin);
    }

    function guessType(src){
      const ext = src.split('?')[0].split('#')[0].trim().toLowerCase().split('.').pop();
      if(ext === 'mp4') return 'video/mp4';
      if(ext === 'mov') return 'video/quicktime';
      return '';
    }
  })();
  </script>
=======
  <title>The Corruptive - Adored</title>
  <link rel="stylesheet" href="assets/css/styles.css" />
  <!-- Defer ensures the DOM is ready when the script runs -->
  <script src="assets/js/media-hero.js" defer></script>
</head>
<body>

  <!--
    USAGE:
      • Image background:
        <section class="media-hero" data-bg="your-image.jpg" data-position="center center">…</section>

      • Video background (MP4/MOV). You can list multiple, comma-separated for fallback:
        <section class="media-hero"
                 data-video="bg.mp4, bg.mov"
                 data-poster="poster.jpg"
                 data-position="center center">…</section>

    NOTES:
      - Keep media on the same origin/folder as this HTML to allow the Canvas sampler.
        If remote, enable CORS on your server and set crossOrigin in JS (see comments).
      - MP4/H.264 has the broadest browser support; MOV varies outside Safari, so include both if you like.
  -->

  <!-- Example: video hero -->
  <section class="media-hero"
           data-video="https://video.thecorruptive.com/Timeline%201.mp4"
           data-poster=""
           data-position="center center">
    <main>
    <!--  <h1>Readable text over a looping video</h1>
      <p class="lede">
        Drop an MP4/MOV next to this file, set <code>data-video</code>, and the template
        auto-tunes contrast so your copy stays readable across frames.
      </p>
      <a class="cta" href="#">Call to Action</a> -->
    </main>
  </section>

  <!-- Example: image hero
  <section class="media-hero" data-bg="your-image.jpg" data-position="top center">
    <main>
      <h1>Readable text over an image</h1>
      <p class="lede">Same adaptive tuning, now for photos.</p>
      <a class="cta" href="#">Learn more</a>
    </main>
  </section>
  -->

>>>>>>> Stashed changes
=======
  <title>The Corruptive - Adored</title>
  <link rel="stylesheet" href="assets/css/styles.css" />
  <!-- Defer ensures the DOM is ready when the script runs -->
  <script src="assets/js/media-hero.js" defer></script>
</head>
<body>

  <!--
    USAGE:
      • Image background:
        <section class="media-hero" data-bg="your-image.jpg" data-position="center center">…</section>

      • Video background (MP4/MOV). You can list multiple, comma-separated for fallback:
        <section class="media-hero"
                 data-video="bg.mp4, bg.mov"
                 data-poster="poster.jpg"
                 data-position="center center">…</section>

    NOTES:
      - Keep media on the same origin/folder as this HTML to allow the Canvas sampler.
        If remote, enable CORS on your server and set crossOrigin in JS (see comments).
      - MP4/H.264 has the broadest browser support; MOV varies outside Safari, so include both if you like.
  -->

  <!-- Example: video hero -->
  <section class="media-hero"
           data-video="https://video.thecorruptive.com/Timeline%201.mp4"
           data-poster=""
           data-position="center center">
    <main>
    <!--  <h1>Readable text over a looping video</h1>
      <p class="lede">
        Drop an MP4/MOV next to this file, set <code>data-video</code>, and the template
        auto-tunes contrast so your copy stays readable across frames.
      </p>
      <a class="cta" href="#">Call to Action</a> -->
    </main>
  </section>

  <!-- Example: image hero
  <section class="media-hero" data-bg="your-image.jpg" data-position="top center">
    <main>
      <h1>Readable text over an image</h1>
      <p class="lede">Same adaptive tuning, now for photos.</p>
      <a class="cta" href="#">Learn more</a>
    </main>
  </section>
  -->

>>>>>>> Stashed changes
</body>
</html>